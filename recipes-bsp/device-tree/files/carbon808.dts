/*
 * CAUTION: This file is automatically generated by Xilinx.
 * Version:
 * Today is: Fri Apr  6 17:23:13 2018
 */


/dts-v1/;
#include "zynqmp.dtsi"
#include "zynqmp-clk-ccf.dtsi"
#include "carbon808-pcw.dtsi"
#include <dt-bindings/interrupt-controller/irq.h>
#include <dt-bindings/pinctrl/pinctrl-zynqmp.h>
#include <dt-bindings/phy/phy.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/gpio/gpio.h>
/ {
    chosen {
        bootargs = "earlycon clk_ignore_unused root=/dev/mmcblk0p2 rw rootwait";
        stdout-path = "serial0:115200n8";
    };

    aliases {
        serial0 = &uart0;
        serial1 = &uart1;
        spi1 = &spi0;
        spi2 = &spi1;
        spi0 = &qspi;
    };
    memory {
        device_type = "memory";
        reg = <0x0 0x0 0x0 0x7ff00000>;
    };

    clocks: clocks {
            ad9361_clkin: clock@0 {
            #clock-cells = <0>;
            compatible = "adjustable-clock";
            clock-frequency = <40000000>;
            clock-accuracy = <200000>; /* 200 ppm (ppb) */
            clock-output-names = "ad9361_ext_refclk";
            };
    };

    fpga_axi: fpga-axi@0 {
        interrupt-parent = <&gic>;
        compatible = "simple-bus";
        #address-cells = <0x1>;
        #size-cells = <0x1>;
        ranges = <0 0 0 0xffffffff>;
        
        bram_ctrl: axi_bram_ctrl@9f000000 {
                        clock-names = "s_axi_aclk";
                        clocks = <&zynqmp_clk 71>;
                        compatible = "xlnx,axi-bram-ctrl-4.1";
                        reg = <0x0 0x9f000000 0x0 0x1000>;
                        xlnx,bram-addr-width = <0xa>;
                        xlnx,bram-inst-mode = "EXTERNAL";
                        xlnx,ecc = <0x0>;
                        xlnx,ecc-onoff-reset-value = <0x0>;
                        xlnx,ecc-type = <0x0>;
                        xlnx,fault-inject = <0x0>;
                        xlnx,memory-depth = <0x400>;
                        xlnx,rd-cmd-optimization = <0x0>;
                        xlnx,read-latency = <0x1>;
                        xlnx,s-axi-ctrl-addr-width = <0x20>;
                        xlnx,s-axi-ctrl-data-width = <0x20>;
                        xlnx,s-axi-id-width = <0x1>;
                        xlnx,s-axi-supports-narrow-burst = <0x0>;
                        xlnx,single-port-bram = <0x1>;
                };

    };
    refclk4: psgtr_dp_clock {
        compatible = "fixed-clock";
        #clock-cells = <0x00>;
        clock-frequency = <100000000>;
    };
 
    refclk3: psgtr_usb_clock {
        compatible = "fixed-clock";
        #clock-cells = <0x00>;
        clock-frequency = <100000000>;
    };
 
    refclk2: psgtr_sata_clock {
        compatible = "fixed-clock";
        #clock-cells = <0x00>;
        clock-frequency = <125000000>; 
    };
 
    refclk1: psgtr_pcie_clock {
        compatible = "fixed-clock";
        #clock-cells = <0x00>;
        clock-frequency = <150000000>;
    };
};
&psgtr {
        status = "okay";
        clocks = <&refclk1>, <&refclk2>, <&refclk3>, <&refclk4>;
        /* ref clk instances used per lane */
        clock-names = "ref0", "ref1", "ref2", "ref3";
};

/*-------------------- QSPI ---------------------*/
&qspi {
    num-cs = <2>;
 
    flash@0 {
        compatible = "jedec,spi-nor";
        reg = <0>, <1>;
        parallel-memories = /bits/ 64 <0x1000000 0x1000000>; /* 2* 16MB --> dummy for all types of this QSPI type */
 
        spi-rx-bus-width = <4>;
        spi-tx-bus-width = <4>;
        spi-max-frequency = <40000000>; //40MHz no real feedback pin
         
        #address-cells = <1>;
        #size-cells = <1>;       
    };
};



/* SDIO */
&sdhci0 {
    // disable-wp;
    no-1-8-v;
};

&sdhci1 {
   disable-wp;
   no-1-8-v;
   status = "okay";
  /* xlnx,mio-bank = <1>;
  /* broken-adma2; */
};

/* QSPI PHY */
&qspi {
    #address-cells = <1>;
    #size-cells = <0>;
    flash0: flash@0 {
        compatible = "jedec,spi-nor";
        reg = <0x0>;
        #address-cells = <1>;
        #size-cells = <1>;
   };
};


/* DMA not used: Reduce error messages on linux.*/

&lpd_dma_chan1 {
    status = "disabled";
};
&lpd_dma_chan2 {
    status = "disabled";
};
&lpd_dma_chan3 {
    status = "disabled";
};
&lpd_dma_chan4 {
    status = "disabled";
};
&lpd_dma_chan5 {
    status = "disabled";
};
&lpd_dma_chan6 {
    status = "disabled";
};
&lpd_dma_chan7 {
    status = "disabled";
};
&lpd_dma_chan8 {
    status = "disabled";
};

//&usb0 {
//	status = "disabled";
//};

&usb0 {
	status = "ok";
    phy-names = "usb3-phy";
    phys = <&psgtr 2 PHY_TYPE_USB3 0 3>;
   /* phys = <&lane2 4 0 3 100000000>;*/
};

&dwc3_0 {
    status = "disabled";
    dr_mode = "peripheral";
    maximum-speed = "super-speed";
    snps,usb3_lpm_capable;
};

//&dwc3_1 {
//    status = "okay";
//    dr_mode = "peripheral";
//    maximum-speed = "super-speed";
//    snps,usb3_lpm_capable;
//    phy-names = "usb3-phy";
//    phys = <&lane3 4 0 1 100000000>;
//};

&i2c1 {

    pac193x@1A {
        compatible = "microchip,pac1934";
        reg = <0x1A>;
        samp-rate = <64>;
        status = "okay";

        ch1: channel@1 {
            reg = <0x1>;
            shunt-resistor-micro-ohms  = <22000000>; /* shunt resistor is 22 milliohm */
            label = "Battery";
         };

        ch2: channel@2 {
            reg = <0x2>;
            shunt-resistor-micro-ohms  = <22000000>; /* shunt resistor is 22 milliohm */
            label = "External_USB_C_PD";
        };

        ch3: channel@3 {
            reg = <0x3>;
            shunt-resistor-micro-ohms  = <5000000>; /* shunt resistor is 5 milliohm */
            label = "USB_C_DRP_Out";
            };

         ch4: channel@4 {
            reg = <0x4>;
            shunt-resistor-micro-ohms  = <5000000>; /* shunt resistor is 5 milliohm */
            label = "Main_3_3V_Bus";
            };
    };
    pac193x@1B {
        compatible = "microchip,pac1934";
        reg = <0x1B>;
        samp-rate = <64>;
        status = "okay";

        ch5: channel@1 {
            reg = <0x1>;
            shunt-resistor-micro-ohms  = <5000000>; /* shunt resistor is 5 milliohm */
            label = "SOM";
         };

        ch6: channel@2 {
            reg = <0x2>;
            shunt-resistor-micro-ohms  = <5000000>; /* shunt resistor is 5 milliohm */
            label = "AD936x_BoardA";
        };

        ch7: channel@3 {
            reg = <0x3>;
            shunt-resistor-micro-ohms  = <5000000>; /* shunt resistor is 5 milliohm */
            label = "AD936x_BoardB";
        };

        ch8: channel@4 {
            reg = <0x4>;
            shunt-resistor-micro-ohms  = <5000000>; /* shunt resistor is 5 milliohm */
            label = "1_8V_BUS";
        };
    
    };
    pac193x@1C {
        compatible = "microchip,pac1934";
        reg = <0x1C>;
        samp-rate = <64>;
        status = "okay";

        ch9: channel@1 {
            reg = <0x1>;
            shunt-resistor-micro-ohms  = <5000000>; /* shunt resistor is 5 milliohm */
            label = "5V_TO_DOCK";
         };

        ch10: channel@2 {
            reg = <0x2>;
            shunt-resistor-micro-ohms  = <5000000>; /* shunt resistor is 5 milliohm */
            label = "3_3V_TO_DOCK";
        };

        ch11: channel@3 {
            reg = <0x3>;
            shunt-resistor-micro-ohms  = <5000000>; /* shunt resistor is 5 milliohm */
            label = "1_8V_TO_DOCK";
        };
    
    };
};
